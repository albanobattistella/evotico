---
import { changeLanguage } from "i18next";
import BaseLayout from "templates/BaseLayout.astro";
import { quickTest } from "composables/quickTestData";

changeLanguage("en");

const { url } = Astro;
const processId = Astro.params.id;
const isDev = processId === "dev";
const res = isDev ? new Response() : await fetch(`${url.origin}/api/process/${processId}`, { method: "GET" });
const data = isDev ? null : await res.json();
const process = isDev ? quickTest() : JSON.parse(data.process);
const proposalPhaseStart = process.proposalDateRange[0]
const proposalPhaseEnd = process.proposalDateRange[1]

const votingPhaseStart = process.votingDateRange[0]
const votingPhaseEnd = process.votingDateRange[1]
switch (true) {
    case !process:
        return Astro.redirect("/");
    case proposalPhaseStart > +new Date() && proposalPhaseEnd < +new Date():
        return Astro.redirect(`${url.origin}/process/${processId}/proposals`);
    case votingPhaseStart > +new Date() && votingPhaseEnd < +new Date():
        return Astro.redirect(`${url.origin}/process/${processId}/voting`);
    case +new Date() > votingPhaseEnd:
        return Astro.redirect(`${url.origin}/process/${processId}/results`);
}
---

<BaseLayout>
    
</BaseLayout>

