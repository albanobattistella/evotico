---
import { changeLanguage } from "i18next";

changeLanguage("en");
---

   
<script>
  /*import { Delta } from 'quill'
  import addAlert from '@utils/addAlert';
  import type IProposal from '@interfaces/IProposal';
  import { createNewProcess } from '@services/api'; 
  const lang = document.documentElement.getAttribute("lang");
  
  class CreateProcess extends HTMLElement {
    scrollTopicQuestion: HTMLElement
    quillDescription: Delta
    alertList: HTMLElement
    alerts: NodeListOf<Element>
    phases: 'full' | 'voting'
    constructor() {
      super();
      this.alertList = this.querySelector('div.alert-list');
      this.alerts = this.querySelectorAll('alert-element');
      this.phases = process.get().phases;

      this.subscribeToProcessStore();
      this.initializeUIComponents();
    }

    subscribeToProcessStore() {
      process.subscribe(() => {
        const currentPhases = JSON.stringify(this.phases);
        const storePhases = JSON.stringify(process.get().phases);
        if (currentPhases !== storePhases) {
          this.phases = JSON.parse(storePhases);
          this.updatePhasesView();
        }
      });
    }

    initializeUIComponents() {
      this.updatePhasesView();
    
      const title = this.querySelector('#topicQuestion') as HTMLInputElement;
      title.addEventListener('input', this.handleTitleInput);
      title.value = process.get().title;

      const createProcessButton = this.querySelector('#createProcessButton') as HTMLButtonElement;
      createProcessButton.addEventListener('click', this.createProcess.bind(this));
    }

    handleTitleInput(e) {
      process.setKey('title', e.target.value);
    }

    updatePhasesView() {
      const isVotingPhase = this.phases === 'voting';
      this.toggleView('.fullOnly', !isVotingPhase);
      this.toggleView('.voteOnly', isVotingPhase);
    }

    toggleView(selector: string, show: boolean) {
      const elements = this.querySelectorAll(selector);
      elements.forEach((element: HTMLElement) => {
          element.style.display = show ? 'block' : 'none';
      });
    }

    checkProposalValues(proposals) {
      return proposals.every((proposal: IProposal) => proposal.title && proposal.description);
    }

    // Create process
    async createProcess() {
      const title = process.get().title.trim();
      if (!title) {

          const rect = this.scrollTopicQuestion.getBoundingClientRect();
          const top = rect.top + window.scrollY - 100;
          window.scrollTo({ top, behavior: 'smooth' });
          addAlert(this.alertList, this.alerts[0])
          return;
      }

      let proposals = process.get().phases === 'full' ? [] : JSON.parse( JSON.stringify(process.get().proposals))

      if (process.get().phases === 'voting') {
          for (let i = 0; i < proposals.length; i++) {
              proposals[i].description = proposals[i].description
          }

          if(proposals.length < 2 || !this.checkProposalValues(proposals)) {
              addAlert(this.alertList, this.alerts[2])
              return
          }
      }

      // Prepare request body
      const body = {
          topicQuestion: process.get().title,
          topicDescription: this.quillDescription.getContents(),
          proposalDates: process.get().phases === 'full' ? process.get().proposalDates : -1,
          votingDates: process.get().votingDates,
          weighting: process.get().weighting,    
          proposals
      }

      try {
          addAlert(this.alertList, this.alerts[4])
          const response = await createNewProcess(body);
          if (response.status === 413) {
              addAlert(this.alertList, this.alerts[3])
              return;
          }

          const processId = response.data.id;
          process.setKey('title', '');
          /* @ts-ignore */
          /*
          process.setKey('description', { ops: [] });
          process.setKey('proposals', []);
          addAlert(this.alertList, this.alerts[1])
          const href = `/${lang !== 'en' ? `${lang}/` : '' }process/${processId}`
          window.location.href = href;
      } catch (error) {
          console.error(error);
      }
    }    
  }
    
  customElements.define('create-process', CreateProcess)*/
</script>