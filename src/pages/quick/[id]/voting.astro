---
import { t, changeLanguage } from "i18next";
import Countdown from "molecules:Countdown";
import BaseLayout from "templates:BaseLayout";
import InfoCard from "organisms:QuickInfoCard";
import { Icon } from 'astro-icon'

changeLanguage("en");

const processId = Astro.params.id;
const { url } = Astro;
const res = await fetch(`${url.origin}/quick/process/${processId}`, { method: "GET" });
const data = await res.json();
const quick = JSON.parse(data.process);
console.log(quick)
---

<BaseLayout>
    <InfoCard title={quick.title} description={quick.description} weighting={quick.weighting}>
        <Countdown label={ t('quick.votingEndTime') } timeleft={ quick.votingEnd } />
  
    </InfoCard>
    <br/>
    <voting-list>
        <div class="proposal">
            <h4>Title</h4>
            <p>Description</p>
            <div class="flex justify-between">
                <Icon width="48" name="rage"/>
                <Icon width="48" name="angry"/>
                <Icon width="48" name="sad"/>
                <Icon width="48" name="neutral"/>
                <Icon width="48" name="smiling"/>
                <Icon width="48" name="happy"/>
                <Icon width="48" name="loving"/>
            </div>
        </div>
    </voting-list>
</BaseLayout>

<script>
    const processId = window.location.pathname.split('/quick/')[1].split('/')[0]
    const res = await fetch(`${location.origin}/quick/process/${processId}`, { method: "GET" });
    const data = await res.json();
    const quick = JSON.parse(data.process)
    class VotingList extends HTMLElement {
        constructor() {
            super()
        }
    }
    customElements.define('voting-list', VotingList)

    const checkTime = () => {
        const time =  +new Date(quick.votingEnd) - +new Date()
        /*if (time <= 0)

            window.location.href = `${window.location.origin}/quick/${processId}/results`
        else
            setTimeout(checkTime, 1000)*/
    }
    checkTime()
</script>